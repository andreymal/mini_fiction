{% extends base %}

{% block extrahead %}
    {{- super() }}
    {% if prev_chapter -%}
        <link rel="prev" href="{{ url_for('chapter.view', story_id=story.id, chapter_order=prev_chapter.order, _external=True) }}" />
    {%- endif %}
    {% if next_chapter -%}
        <link rel="next" href="{{ url_for('chapter.view', story_id=story.id, chapter_order=next_chapter.order, _external=True) }}" />
    {%- endif %}
    <meta name="description" content="{% if allchapters %}
        {%- if chapters -%}{{- chapters[0].text_preview -}}{%- endif -%}
    {% else %}
        {{- chapter.text_preview -}}
    {% endif %}" />
{% endblock %}

{% block content %}
<div class="row">
    {% if allchapters %}
        <div class="span12 story-chapter-page">
            {% include "includes/story_panel.html" %}
            <h1>{{ story.title }}</h1>
            {% for chapter in chapters -%}
                {%- with is_last_chapter=loop.last -%}
                    {%- include "includes/chapter_single.html" -%}
                {%- endwith -%}
            {% endfor -%}
        </div>
    {% else %}
        <div class="span12 story-chapter-page">
            {% include "includes/story_panel.html" %}
            {% include "includes/chapter_single.html" %}
        </div>
    {% endif %}
</div>
{% endblock %}

{%- block modal -%}
    {%- if story.nsfw and not current_user.nsfw -%}
        {%- include 'includes/nsfw_modal.html' -%}
    {%- endif -%}
{%- endblock -%}
