{%- from 'experimental/macro.html' import nav_item, user_avatar -%}
{%- set next_url = (url_for(request.endpoint, **request.view_args) if request.endpoint and not request.endpoint.startswith('auth.') and request.view_args != None else None) -%}

<nav aria-label='Primary links'>
    <ul>
        {{ nav_item(_('Index'), url_for('index.index'), 'index.index') }}
        {{ nav_item(_('Search'), url_for('search.main'), 'search.') }}

        {% if current_user.is_staff -%}
            {{ nav_item(
            'Новые ({})'.format(submitted_stories_count()),
            url_for('object_lists.submitted'),
            match_endpoint='object_lists.submitted'
        ) }}
            {% with abuse_count=unread_abuse_reports_count() %}{% if abuse_count > 0 %}
                {{ nav_item(
            'Жалобы ({})'.format(abuse_count),
            url_for('admin_abuse_reports.index'),
            match_endpoint='admin_abuse_reports.'
        ) }}
            {% endif %}{% endwith %}
        {% endif %}

        {{ nav_item(
            pgettext('help_page', 'Help'),
            url_for('staticpages.index', name='help'),
            matched=is_current_endpoint('staticpages.index', name='help')
        ) }}
        {{ hook('nav') }}
    </ul>
</nav>

{# FIXME #}
<nav aria-label='Personal links'>
    <ul>
        {%- if current_user.is_authenticated %}
            {% set notifications_count = get_unread_notifications_count() %}
            <li>
                {# TODO: Add real bell widget #}
                <a href="{{ url_for('notifications.index') }}">
                    <i class="fas fa-bell fa-lg"
                       {% if notifications_count >0 %}data-count="{{ notifications_count }}"{% endif %}></i>
                </a>
            </li>
            <li>
                <a href="{{ url_for('story.add') }}" class="{% if is_current_endpoint('story.add') %} active{% endif %}"
                   title="{{ _('Add story') }}">
                    <i class="fas fa-plus fa-lg"></i>
                </a>
            </li>
            <li class="dropdown">
                <div class="dropdown__title"
                     aria-expanded="false"
                     aria-controls="profile-dropdown">
                    <span>{{ current_user.username }}</span>
                    <span><i class="fas fa-user-alt fa-lg"></i></span>
                    {# FIXME #}
                    {# {{- user_avatar(current_user) }} #}
                </div>
                <ul class="dropdown__menu" id="profile-dropdown">
                    {{ nav_item(
                        _('Favorites'),
                        url_for('object_lists.favorites', user_id=current_user.id),
                        matched=is_current_endpoint('object_lists.favorites', user_id=current_user.id)
                    ) }}
                    {{ nav_item(_('Read later'), url_for('object_lists.bookmarks'), 'object_lists.bookmarks') }}
                    {{ nav_item(_('Settings'),url_for('author.edit_general'), matched=is_current_endpoint('author.edit_general')) }}
                    {{ nav_item(_('My profile'),url_for('author.info', user_id=current_user.id), matched=is_current_endpoint('author.info', user_id=current_user.id)) }}
                    {{ nav_item(_("Author's cabinet"),url_for('author.info'), matched=is_current_endpoint('author.info', user_id=None)) }}
                    {% if current_user.is_staff %}
                        {{ nav_item(_('Administration'),url_for('admin_index.index'),'admin_index.index') }}
                    {% endif %}
                    {{ nav_item(_('Log out'), url_for('auth.logout', next=next_url), noajax=True) }}
                </ul>
            </li>
        {%- else -%}
            {{ nav_item(_('Log in'), url_for('auth.login', next=next_url), 'auth.login') }}
            {%- if config.REGISTRATION_OPEN %}
                {{ nav_item(_('Register'), url_for('auth.registration'), 'auth.registration') }}
            {% endif %}
        {%- endif -%}
    </ul>
</nav>


