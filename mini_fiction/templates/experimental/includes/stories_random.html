{%- from 'experimental/macro.html' import tag_link with context -%}

{% for random_story in random_stories %}
    <input {% if loop.index == 1 %}checked autofocus{% endif %}
           type="radio" id="slide-trigger-{{ loop.index }}" name="slider">
    <label for="slide-trigger-{{ loop.index }}"></label>
    <div class="slide">
        <h3><a href="{{ url_for('story.view', pk=random_story.id) }}">{{ random_story.title }}</a></h3>
        <p>
            <span class="tags">
                {%- for st in random_story.bl.get_tags_list(sort=True) %}
                    {% if st.tag.is_main_tag %}{{ tag_link(st.tag) -}}{% endif %}
                {% endfor -%}
            </span>
        </p>
{#  FIXME #}
{#        {%- if current_user.is_authenticated -%}#}
{#            <p class="meta">#}
{#                <span class="chapter-controls">#}
{#                    {%- set bookmarked = random_story.bookmarked(current_user.id) -%}#}
{#                    <a title="Прочитать позже"#}
{#                       href="{{ url_for('story.bookmark', pk=random_story.id, action='delete' if bookmarked else 'add') }}"#}
{#                       class="{% if bookmarked %} bookmarked{% endif %}"></a>#}
{#                </span>#}
{#            </p>#}
{#        {%- endif -%}#}
        <p>{{ random_story.summary|striptags }}</p>
        <p>
            <span class="characters">
                {%- for character in random_story.characters|sort(attribute='id') -%}
                    <a href="{{ url_for('search.simple', search_type='character', search_id=character.id) }}">
                        <img width="32" height="32" src="{{ character.url }}" alt="{{ character.name }}"
                             title="{{ character.name }}"/>
                    </a>
                {%- endfor -%}
            </span>
        </p>
    </div>
{% endfor %}
