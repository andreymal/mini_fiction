{% extends base %}
{% from 'macro.html' import breadcrumbs with context %}

{%- block head_js %}
    {{ super() }}
    {% if story_tab == 'general' %}
        {% set editor_js, story_js = webpack_asset('editor.js'), webpack_asset('story.js') %}
        <script defer src="{{ url_for('static', filename='build/{}'.format(editor_js.src)) }}" integrity="{{ editor_js.integrity }}" crossorigin="anonymous"></script>
        <script defer src="{{ url_for('static', filename='build/{}'.format(story_js.src)) }}" integrity="{{ story_js.integrity }}" crossorigin="anonymous"></script>
    {% endif %}
    {% if story_tab == 'chapters' %}
        {% set chapter_sorting_js = webpack_asset('chapter_sorting.js') %}
        <script defer src="{{ url_for('static', filename='build/{}'.format(chapter_sorting_js.src)) }}" integrity="{{ chapter_sorting_js.integrity }}" crossorigin="anonymous"></script>
    {% endif %}
{% endblock %}

{% block content %}
<div class="row">
    <div class="span12">
        {{- breadcrumbs([[url_for('author.info'), _("Author's cabinet")]]) }}
    </div>

    <div class="span12"{% if not story_add %} id="story_{{ story.id }}"{% endif %}>
        {% include 'includes/story_control_buttons.html' %}
        <h1>Редактирование <a class="invisible-link" href="{{ url_for('story.view', pk=story.id, _external=True) }}">«{{ story.title }}»</a></h1>

        <ul class="nav nav-pills nav-simple">
            <li{% if story_tab == 'general' %} class="active"{% endif %}>
                <a href="{{ url_for('story.edit', pk=story.id) }}">{{ pgettext('story_edit_tab', 'General') }}</a>
            </li>
            <li{% if story_tab == 'chapters' %} class="active"{% endif %}>
                <a href="{{ url_for('story.edit_chapters', pk=story.id) }}">{{ pgettext('story_edit_tab', 'Chapters') }}</a>
            </li>
            {% if story.bl.can_edit_contributors(current_user) -%}
                <li{% if story_tab == 'contributors' %} class="active"{% endif %}>
                    <a href="{{ url_for('story.edit_contributors', pk=story.id) }}">{{ pgettext('story_edit_tab', 'Authors and access') }}</a>
                </li>
            {% endif -%}
            {% if current_user.is_staff -%}
                <li{% if story_tab == 'staff' %} class="active"{% endif %}>
                    <a href="{{ url_for('story.edit_staff', pk=story.id) }}">{{ pgettext('story_edit_tab', 'Administration') }}</a>
                </li>
            {% endif -%}
        </ul>

    </div>

    {% block story_edit_content %}{% endblock %}

    <div class="span12">
        {{- breadcrumbs([[url_for('author.info'), _("Author's cabinet")]]) }}
    </div>
</div>
{% endblock %}
